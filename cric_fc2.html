<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cricket Scoreboard</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 10px;
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      text-align: center;
      color: white;
      overflow-x: hidden;
    }
    h1 {
      margin-bottom: 5px;
    }
    .scoreboard, .match-info {
      font-size: 20px;
      margin: 10px 0;
    }
    .buttons, .decrement-buttons, .innings-buttons, .post-match-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 10px 0;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
      background-color: #ff9800;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #fb8c00;
    }
    .overs-visual {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
    }
    .over-container {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      margin: 10px 0;
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      border-radius: 10px;
      border-left: 4px solid #fff;
    }
    .over-label {
      font-weight: bold;
      margin-right: 10px;
      font-size: 18px;
    }
    .ball {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background: white;
      color: black;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 5px;
      font-size: 16px;
    }
    .ball.run { background-color: #2196F3; color: white; }
    .ball.wicket { background-color: #f44336; color: white; }
    .ball.dot { background-color: #4CAF50; color: white; }
    .ball.extra { background-color: #FFEB3B; color: black; }
    .toggle-btn { margin: 10px; padding: 8px 20px; background: #673ab7; }
    .innings-buttons button { background-color: #03A9F4; }
    .fireworks { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
  </style>
</head>
<body>

  <h1>üèè Cricket Scoreboard</h1>
  <div class="match-info" id="matchInfo"></div>

  <div class="scoreboard">
    <div id="score">Score: 0</div>
    <div id="wickets">Wickets: 0</div>
    <div id="overs">Overs: 0.0</div>
    <div id="extras">Extras: 0</div>
    <div id="remaining"></div>
  </div>

  <div class="buttons">
    <button onclick="addRun(1)">+1</button>
    <button onclick="addRun(2)">+2</button>
    <button onclick="addRun(3)">+3</button>
    <button onclick="addRun(4)">+4</button>
    <button onclick="addRun(6)">+6</button>
    <button onclick="addWicket()">Wicket</button>
    <button onclick="addBall()">Dot Ball</button>
    <button onclick="addWide()">Wide</button>
    <button onclick="addNoBall()">No Ball</button>
    <button onclick="undo()">Undo</button>
  </div>

  <div class="decrement-buttons">
    <button onclick="decreaseRun()">-1 Run</button>
    <button onclick="decreaseWicket()">-Wicket</button>
    <button onclick="decreaseBall()">-Ball</button>
  </div>

  <button class="toggle-btn" onclick="toggleOvers()">Show All Overs</button>

  <div class="overs-visual" id="oversVisual"></div>

  <div class="innings-buttons">
    <button onclick="switchInnings(1)">First Innings</button>
    <button onclick="switchInnings(2)">Second Innings</button>
  </div>

  <div class="post-match-buttons">
    <button onclick="copyResult()">üìã Copy Result</button>
    <button onclick="shareWhatsApp()">üì≤ Share WhatsApp</button>
    <button onclick="restartMatch()">üîÑ Restart Match</button>
  </div>

  <canvas class="fireworks" id="fireworks"></canvas>

  <script>
    const matchData = JSON.parse(localStorage.getItem('matchInfo')) || {};
    const totalOvers = matchData.numOvers || 1;

    document.getElementById('matchInfo').innerText = `Match: ${matchData.hostTeam} vs ${matchData.visitorTeam}`;

    let innings = {
      1: { score: 0, wickets: 0, overs: 0, balls: 0, extras: 0, deliveries: [], allOvers: [[]] },
      2: { score: 0, wickets: 0, overs: 0, balls: 0, extras: 0, deliveries: [], allOvers: [[]] }
    };
    let currentInnings = 1;
    let showAll = false;

    function updateDisplay() {
      const i = innings[currentInnings];
      document.getElementById('score').innerText = `Score: ${i.score}`;
      document.getElementById('wickets').innerText = `Wickets: ${i.wickets}`;
      document.getElementById('overs').innerText = `Overs: ${i.overs}.${i.balls}`;
      document.getElementById('extras').innerText = `Extras: ${i.extras}`;
      if (currentInnings === 2) {
        const runsNeeded = innings[1].score - innings[2].score + 1;
        const ballsRemaining = (totalOvers * 6) - (i.overs * 6 + i.balls);
        document.getElementById('remaining').innerText = `Needs ${runsNeeded} from ${ballsRemaining} balls`;
        if (runsNeeded <= 0) endMatch(`${matchData.visitorTeam} won by ${10 - i.wickets} wickets`);
        if (ballsRemaining <= 0 || i.wickets === 10) {
          let result;
          if (i.score > innings[1].score) result = `${matchData.visitorTeam} won`;
          else if (i.score === innings[1].score) result = `Match Tied`;
          else result = `${matchData.hostTeam} won by ${innings[1].score - i.score} runs`;
          endMatch(result);
        }
      } else {
        document.getElementById('remaining').innerText = '';
      }
    }

    function renderOversVisual() {
      const container = document.getElementById('oversVisual');
      container.innerHTML = '';

      const i = innings[currentInnings];
      let oversToRender = showAll ? i.allOvers : [i.allOvers[i.allOvers.length - 1]];

      oversToRender.forEach((over, index) => {
        const overContainer = document.createElement('div');
        overContainer.className = 'over-container';

        const overLabel = document.createElement('div');
        overLabel.className = 'over-label';
        overLabel.innerText = `Over ${showAll ? index + 1 : i.allOvers.length}`;
        overContainer.appendChild(overLabel);

        over.forEach(d => {
          const ball = document.createElement('div');
          ball.className = 'ball';
          ball.innerText = d.label;
          ball.classList.add(d.className);
          overContainer.appendChild(ball);
        });

        container.appendChild(overContainer);
      });
    }

    function addDelivery(label, isLegal, className) {
      const i = innings[currentInnings];
      i.deliveries.push({ label, isLegal, className });
      i.allOvers[i.allOvers.length - 1].push({ label, isLegal, className });

      if (isLegal) {
        i.balls++;
        if (i.balls === 6) {
          i.overs++;
          i.balls = 0;
          i.allOvers.push([]);
        }
      }
      updateDisplay();
      renderOversVisual();
    }

    function addRun(runs) {
      innings[currentInnings].score += runs;
      addDelivery(runs.toString(), true, 'run');
    }

    function addWicket() {
      innings[currentInnings].wickets++;
      addDelivery('W', true, 'wicket');
    }

    function addBall() {
      addDelivery('.', true, 'dot');
    }

    function addWide() {
      innings[currentInnings].score++;
      innings[currentInnings].extras++;
      addDelivery('Wd', false, 'extra');
    }

    function addNoBall() {
      innings[currentInnings].score++;
      innings[currentInnings].extras++;
      addDelivery('Nb', false, 'extra');
    }

    function undo() {
      const i = innings[currentInnings];
      if (i.deliveries.length === 0) return;
      const last = i.deliveries.pop();
      const lastOver = i.allOvers[i.allOvers.length - 1];
      lastOver.pop();
      if (lastOver.length === 0 && i.allOvers.length > 1) i.allOvers.pop();
      if (last.isLegal) {
        if (i.balls === 0 && i.overs > 0) {
          i.overs--;
          i.balls = 5;
        } else {
          i.balls--;
        }
      }
      if (last.label === 'W') i.wickets = Math.max(0, i.wickets - 1);
      else if (last.label === 'Wd' || last.label === 'Nb') {
        i.score = Math.max(0, i.score - 1);
        i.extras = Math.max(0, i.extras - 1);
      } else if (!isNaN(parseInt(last.label))) i.score = Math.max(0, i.score - parseInt(last.label));
      updateDisplay();
      renderOversVisual();
    }

    function decreaseRun() { innings[currentInnings].score = Math.max(0, innings[currentInnings].score - 1); updateDisplay(); }
    function decreaseWicket() { innings[currentInnings].wickets = Math.max(0, innings[currentInnings].wickets - 1); updateDisplay(); }
    function decreaseBall() {
      const i = innings[currentInnings];
      if (i.balls > 0) i.balls--;
      else if (i.overs > 0) { i.overs--; i.balls = 5; }
      updateDisplay();
      renderOversVisual();
    }

    function toggleOvers() {
      showAll = !showAll;
      document.querySelector('.toggle-btn').innerText = showAll ? "Hide Previous Overs" : "Show All Overs";
      renderOversVisual();
    }

    function switchInnings(number) {
      currentInnings = number;
      updateDisplay();
      renderOversVisual();
    }

    function endMatch(result) {
      document.getElementById('remaining').innerText = result;
      triggerFireworks();
    }

    function copyResult() {
      navigator.clipboard.writeText(document.getElementById('remaining').innerText);
      alert("Result copied to clipboard!");
    }

    function shareWhatsApp() {
      const text = encodeURIComponent(document.getElementById('remaining').innerText);
      window.open(`https://wa.me/?text=${text}`);
    }

    function restartMatch() {
      localStorage.removeItem('matchInfo');
      location.href = 'setup.html';
    }

    function triggerFireworks() {
      const canvas = document.getElementById('fireworks');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      let particles = [];
      for (let i = 0; i < 100; i++) {
        particles.push({
          x: canvas.width / 2,
          y: canvas.height / 2,
          dx: Math.random() * 10 - 5,
          dy: Math.random() * 10 - 5,
          radius: Math.random() * 3 + 2,
          color: `hsl(${Math.random() * 360}, 100%, 50%)`
        });
      }

      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach(p => {
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
          ctx.fillStyle = p.color;
          ctx.fill();
          p.x += p.dx;
          p.y += p.dy;
          p.dy += 0.1;
        });
        requestAnimationFrame(animate);
      }
      animate();
    }

    updateDisplay();
    renderOversVisual();
  </script>

</body>
</html>
